import{r as N,a as f,c as h,b as s,d as K,w as v,v as b,t as U,e as be,f as O,n as Z,F as B,g as W,h as Ne,o as Se,i as ke,j as Ie,k as m,l as Ce}from"./vue-vendor-CDkDDy0R.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const t of a.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&o(t)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();const I=N([]),x=N([]),P=N([]),q=f(""),L=N({strengths:"",weaknesses:"",opportunities:"",threats:""});function Q(n){try{const e=localStorage.getItem("mvp-history"),r=e?JSON.parse(e):[],o={territories:JSON.parse(JSON.stringify(I)),nodes:JSON.parse(JSON.stringify(x)),edges:JSON.parse(JSON.stringify(P)),swot:{...L},ts:Date.now(),name:n};r.push({id:crypto.randomUUID(),ts:Date.now(),name:n||`snap-${r.length+1}`,data:o}),localStorage.setItem("mvp-history",JSON.stringify(r))}catch(e){throw console.error("Failed to save snapshot:",e),new Error(`Snapshot save failed: ${e.message}`)}}function Ee(n){try{const e=localStorage.getItem("mvp-history");if(!e)throw new Error("No saved history found");const o=JSON.parse(e)[n];if(!o||!o.data)throw new Error(`Invalid snapshot at index ${n}`);I.splice(0),x.splice(0),P.splice(0),(o.data.territories||[]).forEach(i=>I.push(i)),(o.data.nodes||[]).forEach(i=>x.push(i)),(o.data.edges||[]).forEach(i=>P.push(i)),o.data.swot&&Object.assign(L,o.data.swot)}catch(e){throw console.error("Failed to load snapshot:",e),new Error(`Snapshot load failed: ${e.message}`)}}function Me(){q.value.toLowerCase().includes("ielts")?(L.strengths="Good listening",L.weaknesses="Timing in writing"):L.strengths="Creative",alert("SWOT drafted (stub).")}async function Le(){try{I.splice(0),x.splice(0),P.splice(0);const n=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:q.value||"Create a learning plan for IELTS preparation with listening, reading, writing, and speaking skills"})});if(!n.ok)throw new Error(`API error: ${n.status}`);const r=(await n.json()).data,o=r.nodes.map(a=>({id:a.id||crypto.randomUUID(),label:a.label,type:a.type||"concept",note:"",status:"todo",timestamp:Date.now()})),i=r.edges.map(a=>({id:a.id||crypto.randomUUID(),source:a.source,target:a.target,type:a.type||"relationship"}));o.forEach(a=>x.push(a)),i.forEach(a=>P.push(a)),r.territories&&r.territories.length>0&&r.territories.forEach((u,g)=>{const p=g%3,D=Math.floor(g/3);I.push({id:u.id||crypto.randomUUID(),label:u.name,x:100+p*450,y:100+D*400,w:400,h:350,nodeIds:u.nodeIds||[]})}),x.forEach(a=>{const t=I.find(c=>c.nodeIds&&c.nodeIds.includes(a.id));if(t){const c=t.nodeIds.indexOf(a.id),u=t.nodeIds.length,g=c%2,p=Math.floor(c/2);a.x=t.x+80+g*120,a.y=t.y+60+p*70}else a.x=Math.random()*800+100,a.y=Math.random()*600+100}),Q("auto-generate"),console.log("✓ Map generated from LLM with algorithmic positioning")}catch(n){console.error("Map generation failed:",n),alert(`Failed to generate map: ${n.message}`)}}function Pe(){return{territories:I,nodes:x,edges:P,chatInput:q,swot:L,saveSnapshot:Q,loadSnapshot:Ee,runAnalysis:Me,generateMap:Le}}const E=N({x:0,y:0,w:1600,h:900}),l=N({x:E.x,y:E.y,w:E.w,h:E.h}),A=f(!1),M=N({x:0,y:0});function z(n){const e=document.querySelector("svg");if(!e)return console.warn("SVG element not found"),{x:0,y:0};const r=e.getBoundingClientRect(),o=(n.clientX-r.left)/r.width,i=(n.clientY-r.top)/r.height;return{x:l.x+o*l.w,y:l.y+i*l.h}}function De(n){const e=document.querySelector("svg");if(!e)return console.warn("SVG element not found"),{x:0,y:0,rect:null};const r=e.getBoundingClientRect(),o=(n.x-l.x)/l.w*r.width+r.left,i=(n.y-l.y)/l.h*r.height+r.top;return{x:o,y:i,rect:r}}function Ue(n){A.value=!0,M.x=n.clientX,M.y=n.clientY}function Ae(n){if(!A.value)return;const e=n.currentTarget,r=(n.clientX-M.x)*(l.w/e.clientWidth),o=(n.clientY-M.y)*(l.h/e.clientHeight);l.x-=r,l.y-=o,M.x=n.clientX,M.y=n.clientY}function Te(){A.value=!1}const Oe=n=>{const r=n.currentTarget.getBoundingClientRect(),o=n.clientX-r.left,i=n.clientY-r.top,a=n.deltaY<0?.9:1.1,t=l.x+o/r.width*l.w,c=l.y+i/r.height*l.h,u=l.w*a,g=l.h*a;l.x=t-o/r.width*u,l.y=c-i/r.height*g,l.w=u,l.h=g};function Be(n,e=2,r=300){const o={x:l.x,y:l.y,w:l.w,h:l.h},i=n.x,a=n.y,t=E.w/e,c=E.h/e,u={x:i-t/2,y:a-c/2,w:t,h:c},g=performance.now();function p(D){const S=Math.min(1,(D-g)/r),C=1-Math.pow(1-S,2);l.x=o.x+(u.x-o.x)*C,l.y=o.y+(u.y-o.y)*C,l.w=o.w+(u.w-o.w)*C,l.h=o.h+(u.h-o.h)*C,S<1&&requestAnimationFrame(p)}requestAnimationFrame(p)}function We(){return{viewBox:l,isPanning:A,onPanStart:Ue,onPanMove:Ae,onPanEnd:Te,onWheel:Oe,svgToWorld:z,worldToScreen:De,zoomToNode:Be}}const F=f(null),V=f(""),R=f(null),w=N({active:!1,id:null,ox:0,oy:0});function Ve(n){return x.find(e=>e.id===n)}function qe(n){F.value=n,R.value=n}function ze(){F.value=null,R.value=null}function Fe(){const n=V.value.trim();if(!n){console.warn("Cannot add node with empty label");return}const r={id:crypto.randomUUID(),label:n,x:l.x+l.w/2,y:l.y+l.h/2,territoryId:null,note:"",status:"todo",timestamp:Date.now()};x.push(r),V.value=""}const Re=(n,e)=>{n.stopPropagation();const r=z(n);w.active=!0,w.id=e.id,w.ox=r.x-e.x,w.oy=r.y-e.y,window.addEventListener("mousemove",H),window.addEventListener("mouseup",J)},H=n=>{if(!w.active||!w.id)return;const e=z(n),r=x.find(o=>o.id===w.id);r&&(r.x=e.x-w.ox,r.y=e.y-w.oy)},J=n=>{w.active=!1,w.id=null,window.removeEventListener("mousemove",H),window.removeEventListener("mouseup",J)};function He(){return{selectedNode:F,quickNodeLabel:V,editingNode:R,dragging:w,nodeById:Ve,selectNode:qe,deselectNode:ze,quickAddNode:Fe,onNodeDragStart:Re,onNodeDragMove:H,onNodeDragEnd:J}}const Je=(n,e)=>{const r=n.__vccOpts||n;for(const[o,i]of e)r[o]=i;return r},Ye={name:"App",setup(){const n=f(null),e=(d,k="")=>{console.error(`[App Error] ${k}:`,d),n.value=`${k}: ${d.message||d}`,setTimeout(()=>{n.value=null},5e3)},r=()=>{n.value=null};Se((d,k,T)=>(e(d,`Component error (${T})`),!1));let o,i,a;try{o=Pe(),i=We(),a=He()}catch(d){e(d,"Composable initialization failed"),o={territories:f([]),nodes:f([]),edges:f([]),chatInput:f(""),swot:f({})},i={viewBox:f({x:0,y:0,w:1600,h:900}),isPanning:f(!1)},a={selectedNode:f(null),quickNodeLabel:f("")}}const{territories:t,nodes:c,edges:u,chatInput:g,swot:p,runAnalysis:D,generateMap:S,saveSnapshot:C,loadSnapshot:_}=o,{viewBox:y,isPanning:$,onPanStart:ee,onPanMove:oe,onPanEnd:te,onWheel:ne,svgToWorld:yo,worldToScreen:go,zoomToNode:re}=i,{selectedNode:X,quickNodeLabel:se,editingNode:ae,dragging:po,nodeById:ie,selectNode:le,deselectNode:de,quickAddNode:ce,onNodeDragStart:ue,onNodeDragMove:ye,onNodeDragEnd:ge}=a,pe=ke(()=>(100*(1600/y.w)).toFixed(0)),fe=()=>{try{C(`manual-${Date.now()}`),console.log("✓ State saved successfully")}catch(d){e(d,"Save failed")}},we=()=>{try{_(0),console.log("✓ State loaded successfully")}catch(d){e(d,"Load failed")}},he=()=>{try{confirm("Reset all data? This cannot be undone.")&&(t.splice(0),c.splice(0),u.splice(0),g.value="",p.strengths="",p.weaknesses="",p.opportunities="",p.threats="",console.log("✓ Reset complete"))}catch(d){e(d,"Reset failed")}},me=()=>{console.log("Node updated:",X.value)},xe=d=>{try{const k=y.x+y.w/2,T=y.y+y.h/2,G=y.w/d,j=y.h/d;y.x=k-G/2,y.y=T-j/2,y.w=G,y.h=j}catch(k){e(k,"Zoom failed")}},ve=()=>{try{y.x=0,y.y=0,y.w=1600,y.h=900}catch(d){e(d,"Center view failed")}};return Ie(()=>{try{S&&typeof S=="function"&&(S(),console.log("✓ Initial map generated"))}catch(d){e(d,"Initial map generation failed")}}),{chatInput:g,swot:p,territories:t,nodes:c,edges:u,selectedNode:X,quickNodeLabel:se,editingNode:ae,viewBox:y,isPanning:$,zoomPercentage:pe,runAnalysis:D,generateMap:S,handleSave:fe,handleLoad:we,handleReset:he,handleNodeUpdate:me,onWheel:ne,onPanStart:ee,onPanMove:oe,onPanEnd:te,onNodeDragStart:ue,onNodeDragMove:ye,onNodeDragEnd:ge,nodeById:ie,selectNode:le,deselectNode:de,quickAddNode:ce,zoomToNode:re,zoomAtCenter:xe,centerView:ve,error:n,clearError:r}}},Xe={class:"app"},Ge={class:"sidebar"},je={class:"row"},Ke={class:"row"},Ze={class:"main"},Qe={class:"toolbar"},_e={class:"badge"},$e={class:"canvas-wrap"},eo=["viewBox"],oo=["x","y","width","height"],to=["x","y"],no=["x1","y1","x2","y2"],ro=["onMousedown","onDblclick"],so=["x","y"],ao=["x","y"],io={key:0,class:"inspector"};function lo(n,e,r,o,i,a){return m(),h("div",Xe,[s("aside",Ge,[s("div",null,[e[29]||(e[29]=s("h2",null,"Character Chat ▸ Needs",-1)),v(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.chatInput=t),placeholder:"e.g. I want to prepare for IELTS in 8 weeks; I struggle with timing and writing Task 1..."},null,512),[[b,o.chatInput]]),s("div",je,[s("button",{class:"btn",onClick:e[1]||(e[1]=(...t)=>o.runAnalysis&&o.runAnalysis(...t))},"Analyze ▸ SWOT"),s("button",{class:"btn",onClick:e[2]||(e[2]=(...t)=>o.generateMap&&o.generateMap(...t))},"Generate Map")])]),s("div",null,[e[30]||(e[30]=s("h2",null,"SWOT (editable)",-1)),e[31]||(e[31]=s("label",{class:"muted"},"Strengths",-1)),v(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.swot.strengths=t)},null,512),[[b,o.swot.strengths]]),e[32]||(e[32]=s("label",{class:"muted"},"Weaknesses",-1)),v(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.swot.weaknesses=t)},null,512),[[b,o.swot.weaknesses]]),e[33]||(e[33]=s("label",{class:"muted"},"Opportunities",-1)),v(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.swot.opportunities=t)},null,512),[[b,o.swot.opportunities]]),e[34]||(e[34]=s("label",{class:"muted"},"Threats",-1)),v(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.swot.threats=t)},null,512),[[b,o.swot.threats]]),s("div",Ke,[s("button",{class:"btn",onClick:e[7]||(e[7]=(...t)=>o.handleSave&&o.handleSave(...t))},"Save"),s("button",{class:"btn",onClick:e[8]||(e[8]=(...t)=>o.handleLoad&&o.handleLoad(...t))},"Load"),s("button",{class:"btn",onClick:e[9]||(e[9]=(...t)=>o.handleReset&&o.handleReset(...t))},"Reset")])])]),s("main",Ze,[s("div",Qe,[s("span",_e,"Zoom: "+U(o.zoomPercentage)+"%",1),s("button",{class:"btn",onClick:e[10]||(e[10]=()=>o.zoomAtCenter(1.2))},"+"),s("button",{class:"btn",onClick:e[11]||(e[11]=()=>o.zoomAtCenter(1/1.2))},"−"),s("button",{class:"btn",onClick:e[12]||(e[12]=(...t)=>o.centerView&&o.centerView(...t))},"Center"),v(s("input",{type:"text",placeholder:"Quick add node (Label)","onUpdate:modelValue":e[13]||(e[13]=t=>o.quickNodeLabel=t),onKeydown:e[14]||(e[14]=be((...t)=>o.quickAddNode&&o.quickAddNode(...t),["enter"]))},null,544),[[b,o.quickNodeLabel]]),s("button",{class:"btn",onClick:e[15]||(e[15]=(...t)=>o.quickAddNode&&o.quickAddNode(...t))},"Add Node"),e[35]||(e[35]=s("span",{class:"muted"},"Click+Drag to pan · Scroll to zoom · Drag nodes",-1))]),s("section",$e,[(m(),h("svg",{class:Z({dragging:o.isPanning}),viewBox:`${o.viewBox.x} ${o.viewBox.y} ${o.viewBox.w} ${o.viewBox.h}`,onMousedown:e[16]||(e[16]=(...t)=>o.onPanStart&&o.onPanStart(...t)),onMousemove:e[17]||(e[17]=(...t)=>o.onPanMove&&o.onPanMove(...t)),onMouseup:e[18]||(e[18]=(...t)=>o.onPanEnd&&o.onPanEnd(...t)),onMouseleave:e[19]||(e[19]=(...t)=>o.onPanEnd&&o.onPanEnd(...t)),onWheel:e[20]||(e[20]=O((...t)=>o.onWheel&&o.onWheel(...t),["prevent"]))},[e[36]||(e[36]=s("defs",null,[s("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse"},[s("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#b9bfd2"})])],-1)),(m(!0),h(B,null,W(o.territories,t=>(m(),h("g",{key:t.id},[s("rect",{class:"territory",x:t.x,y:t.y,rx:12,ry:12,width:t.w,height:t.h},null,8,oo),s("text",{class:"territory-title",x:t.x+10,y:t.y+18},U(t.label),9,to)]))),128)),s("g",null,[(m(!0),h(B,null,W(o.edges,t=>{var c,u,g,p;return m(),h("line",{key:t.id,class:"edge",x1:((c=o.nodeById(t.source))==null?void 0:c.x)||0,y1:((u=o.nodeById(t.source))==null?void 0:u.y)||0,x2:((g=o.nodeById(t.target))==null?void 0:g.x)||0,y2:((p=o.nodeById(t.target))==null?void 0:p.y)||0},null,8,no)}),128))]),(m(!0),h(B,null,W(o.nodes,t=>(m(),h("g",{key:t.id,onMousedown:O(c=>o.onNodeDragStart(c,t),["stop"]),onDblclick:O(()=>o.selectNode(t),["stop"])},[s("rect",{class:Z(["node",o.selectedNode&&o.selectedNode.id===t.id?"selected":""]),x:t.x-60,y:t.y-22,rx:"10",ry:"10",width:"120",height:"44"},null,10,so),s("text",{class:"node-label",x:t.x,y:t.y+4,"text-anchor":"middle"},U(t.label),9,ao)],40,ro))),128))],42,eo)),o.selectedNode?(m(),h("div",io,[s("h3",null,U(o.selectedNode.label),1),v(s("input",{"onUpdate:modelValue":e[21]||(e[21]=t=>o.selectedNode.label=t),placeholder:"Node Label",onInput:e[22]||(e[22]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},null,544),[[b,o.selectedNode.label]]),v(s("textarea",{"onUpdate:modelValue":e[23]||(e[23]=t=>o.selectedNode.note=t),placeholder:"Notes...",onInput:e[24]||(e[24]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},null,544),[[b,o.selectedNode.note]]),v(s("select",{"onUpdate:modelValue":e[25]||(e[25]=t=>o.selectedNode.status=t),onChange:e[26]||(e[26]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},[...e[37]||(e[37]=[s("option",{value:"todo"},"To Do",-1),s("option",{value:"in-progress"},"In Progress",-1),s("option",{value:"done"},"Done",-1)])],544),[[Ne,o.selectedNode.status]]),s("button",{class:"btn",onClick:e[27]||(e[27]=(...t)=>o.deselectNode&&o.deselectNode(...t))},"Close")])):K("",!0)])]),o.error?(m(),h("div",{key:0,class:"error-banner",onClick:e[28]||(e[28]=(...t)=>o.clearError&&o.clearError(...t))},U(o.error)+" (click to dismiss) ",1)):K("",!0)])}const co=Je(Ye,[["render",lo],["__scopeId","data-v-9b652b4d"]]),uo=(n,e,r)=>{console.error("Global Error:",n),console.error("Component:",e),console.error("Error Info:",r)},Y=Ce(co);Y.config.errorHandler=uo;Y.config.performance=!0;try{Y.mount("#app"),console.log("✓ Character Canvas initialized successfully")}catch(n){console.error("Failed to mount Vue app:",n),document.querySelector("#app").innerHTML=`
    <div style="padding: 20px; font-family: system-ui;">
      <h1 style="color: #c33;">Application Failed to Load</h1>
      <p>An error occurred while initializing the application.</p>
      <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto;">
${n.stack||n.message}
      </pre>
      <button onclick="location.reload()" style="padding: 10px 20px; border-radius: 6px; border: none; background: #111; color: #fff; cursor: pointer;">
        Reload Page
      </button>
    </div>
  `}
//# sourceMappingURL=index-CjZIvgja.js.map
