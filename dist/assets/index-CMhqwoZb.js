import{r as E,a as w,c as v,b as a,d as ee,w as N,v as I,t as D,e as Te,f as q,n as oe,F as Y,g as z,h as Oe,o as Ae,i as Le,j as De,k as b,l as Re}from"./vue-vendor-CDkDDy0R.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const t of c.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&o(t)}).observe(document,{childList:!0,subtree:!0});function s(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(i){if(i.ep)return;i.ep=!0;const c=s(i);fetch(i.href,c)}})();const k=E([]),f=E([]),M=E([]),G=w(""),L=E({strengths:"",weaknesses:"",opportunities:"",threats:""});function se(n){try{const e=localStorage.getItem("mvp-history"),s=e?JSON.parse(e):[],o={territories:JSON.parse(JSON.stringify(k)),nodes:JSON.parse(JSON.stringify(f)),edges:JSON.parse(JSON.stringify(M)),swot:{...L},ts:Date.now(),name:n};s.push({id:crypto.randomUUID(),ts:Date.now(),name:n||`snap-${s.length+1}`,data:o}),localStorage.setItem("mvp-history",JSON.stringify(s))}catch(e){throw console.error("Failed to save snapshot:",e),new Error(`Snapshot save failed: ${e.message}`)}}function Ue(n){try{const e=localStorage.getItem("mvp-history");if(!e)throw new Error("No saved history found");const o=JSON.parse(e)[n];if(!o||!o.data)throw new Error(`Invalid snapshot at index ${n}`);k.splice(0),f.splice(0),M.splice(0),(o.data.territories||[]).forEach(i=>k.push(i)),(o.data.nodes||[]).forEach(i=>f.push(i)),(o.data.edges||[]).forEach(i=>M.push(i)),o.data.swot&&Object.assign(L,o.data.swot)}catch(e){throw console.error("Failed to load snapshot:",e),new Error(`Snapshot load failed: ${e.message}`)}}const T=20,re=60,U=180,B=80,ae=20,ie=20,R=2,te=50,ne=3;function Be(n){const e=Math.ceil(n/R),s=T*2+R*U+(R-1)*ae,o=re+T*2+e*B+(e-1)*ie;return{width:Math.max(s,400),height:Math.max(o,350)}}function We(n,e,s){const o=s%R,i=Math.floor(s/R),c=e.x+T+o*(U+ae),t=e.y+re+T+i*(B+ie),y=e.x+e.w-U-T,r=e.y+e.h-B-T,d=Math.min(c,y),u=Math.min(t,r);return(c!==d||t!==u)&&console.warn(`âš ï¸ Node "${n.label}" clamped in territory "${e.label}":`,{original:{x:c,y:t},clamped:{x:d,y:u},territory:{bounds:{x:e.x,y:e.y,w:e.w,h:e.h},maxAllowed:{x:y,y:r}}}),{x:d,y:u}}function Ve(){G.value.toLowerCase().includes("ielts")?(L.strengths="Good listening",L.weaknesses="Timing in writing"):L.strengths="Creative",alert("SWOT drafted (stub).")}async function qe(){var n;try{console.log("ðŸš€ Starting map generation..."),k.splice(0),f.splice(0),M.splice(0);const e=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:G.value||"Create a learning plan for IELTS preparation with listening, reading, writing, and speaking skills"})});if(!e.ok){const r=await e.json().catch(()=>null),d=(r==null?void 0:r.error)||`Server error: ${e.status}`;throw new Error(d)}const s=await e.json();if(!s.success)throw new Error(s.error||"Map generation failed");(n=s.metadata)!=null&&n.fallback&&(console.warn("âš ï¸ Using fallback map - LLM response was invalid"),alert("Warning: Map generation used fallback mode. Results may be limited."));const o=s.data,i=o.nodes.map(r=>({id:r.id||crypto.randomUUID(),label:r.label,type:r.type||"concept",note:"",status:"todo",timestamp:Date.now()})),c=o.edges.map(r=>({id:r.id||crypto.randomUUID(),source:r.source,target:r.target,type:r.type||"relationship"}));i.forEach(r=>f.push(r)),c.forEach(r=>M.push(r)),o.territories&&o.territories.length>0&&(console.log("ðŸ—ºï¸ Creating territories with dynamic sizing..."),o.territories.forEach((r,d)=>{const u=(r.nodeIds||[]).length,m=Be(u),x=d%ne,S=Math.floor(d/ne),P={id:r.id||crypto.randomUUID(),label:r.name,x:100+x*(m.width+te),y:100+S*(m.height+te),w:m.width,h:m.height,nodeIds:r.nodeIds||[]};k.push(P),console.log(`  ðŸ“¦ Territory "${P.label}":`,{nodes:u,dimensions:{w:m.width,h:m.height},position:{x:P.x,y:P.y}})})),console.log(`
ðŸ“ Positioning nodes within territories...`);let t=0,y=0;f.forEach(r=>{const d=k.find(u=>u.nodeIds&&u.nodeIds.includes(r.id));if(d){const u=d.nodeIds.indexOf(r.id),m=We(r,d,u);r.x=m.x,r.y=m.y,t++,r.x>=d.x&&r.x+U<=d.x+d.w&&r.y>=d.y&&r.y+B<=d.y+d.h||console.error(`âŒ Node "${r.label}" STILL outside territory "${d.label}"!`,{node:{x:r.x,y:r.y},territory:{x:d.x,y:d.y,w:d.w,h:d.h}})}else r.x=Math.random()*800+100,r.y=Math.random()*600+100,y++,console.warn(`âš ï¸ Node "${r.label}" has no territory assignment`)}),console.log(`âœ“ Positioned ${t} nodes, ${y} outside territories`),se("auto-generate"),console.log("âœ… Map generation complete!"),console.log(`   â†’ ${k.length} territories`),console.log(`   â†’ ${f.length} nodes`),console.log(`   â†’ ${M.length} edges`)}catch(e){console.error("âŒ Map generation failed:",e);let s="Failed to generate map. ";throw e.message.includes("Rate limit")||e.message.includes("busy")?s+="The AI service is currently busy. Please wait a moment and try again.":e.message.includes("API key")||e.message.includes("not configured")?s+="API configuration error. Please check your API keys.":e.message.includes("Invalid map structure")?s+="The AI returned an invalid response. Please try a different prompt.":s+=e.message,alert(s),e}}function Ye(){return{territories:k,nodes:f,edges:M,chatInput:G,swot:L,saveSnapshot:se,loadSnapshot:Ue,runAnalysis:Ve,generateMap:qe}}const O=E({x:0,y:0,w:1600,h:900}),l=E({x:O.x,y:O.y,w:O.w,h:O.h}),W=w(!1),A=E({x:0,y:0});function H(n){const e=document.querySelector("svg");if(!e)return console.warn("SVG element not found"),{x:0,y:0};const s=e.getBoundingClientRect(),o=(n.clientX-s.left)/s.width,i=(n.clientY-s.top)/s.height;return{x:l.x+o*l.w,y:l.y+i*l.h}}function ze(n){const e=document.querySelector("svg");if(!e)return console.warn("SVG element not found"),{x:0,y:0,rect:null};const s=e.getBoundingClientRect(),o=(n.x-l.x)/l.w*s.width+s.left,i=(n.y-l.y)/l.h*s.height+s.top;return{x:o,y:i,rect:s}}function Fe(n){W.value=!0,A.x=n.clientX,A.y=n.clientY}function Ge(n){if(!W.value)return;const e=n.currentTarget,s=(n.clientX-A.x)*(l.w/e.clientWidth),o=(n.clientY-A.y)*(l.h/e.clientHeight);l.x-=s,l.y-=o,A.x=n.clientX,A.y=n.clientY}function He(){W.value=!1}const Je=n=>{const s=n.currentTarget.getBoundingClientRect(),o=n.clientX-s.left,i=n.clientY-s.top,c=n.deltaY<0?.9:1.1,t=l.x+o/s.width*l.w,y=l.y+i/s.height*l.h,r=l.w*c,d=l.h*c;l.x=t-o/s.width*r,l.y=y-i/s.height*d,l.w=r,l.h=d};function Xe(n,e=2,s=300){const o={x:l.x,y:l.y,w:l.w,h:l.h},i=n.x,c=n.y,t=O.w/e,y=O.h/e,r={x:i-t/2,y:c-y/2,w:t,h:y},d=performance.now();function u(m){const x=Math.min(1,(m-d)/s),S=1-Math.pow(1-x,2);l.x=o.x+(r.x-o.x)*S,l.y=o.y+(r.y-o.y)*S,l.w=o.w+(r.w-o.w)*S,l.h=o.h+(r.h-o.h)*S,x<1&&requestAnimationFrame(u)}requestAnimationFrame(u)}function je(){return{viewBox:l,isPanning:W,onPanStart:Fe,onPanMove:Ge,onPanEnd:He,onWheel:Je,svgToWorld:H,worldToScreen:ze,zoomToNode:Xe}}const J=w(null),F=w(""),X=w(null),p=E({active:!1,id:null,ox:0,oy:0});function Ke(n){return f.find(e=>e.id===n)}function Ze(n){J.value=n,X.value=n}function Qe(){J.value=null,X.value=null}function _e(){const n=F.value.trim();if(!n){console.warn("Cannot add node with empty label");return}const s={id:crypto.randomUUID(),label:n,x:l.x+l.w/2,y:l.y+l.h/2,territoryId:null,note:"",status:"todo",timestamp:Date.now()};f.push(s),F.value=""}const $e=(n,e)=>{n.stopPropagation();const s=H(n);p.active=!0,p.id=e.id,p.ox=s.x-e.x,p.oy=s.y-e.y,window.addEventListener("mousemove",j),window.addEventListener("mouseup",K)},j=n=>{if(!p.active||!p.id)return;const e=H(n),s=f.find(o=>o.id===p.id);s&&(s.x=e.x-p.ox,s.y=e.y-p.oy)},K=n=>{p.active=!1,p.id=null,window.removeEventListener("mousemove",j),window.removeEventListener("mouseup",K)};function eo(){return{selectedNode:J,quickNodeLabel:F,editingNode:X,dragging:p,nodeById:Ke,selectNode:Ze,deselectNode:Qe,quickAddNode:_e,onNodeDragStart:$e,onNodeDragMove:j,onNodeDragEnd:K}}const oo=(n,e)=>{const s=n.__vccOpts||n;for(const[o,i]of e)s[o]=i;return s},to={name:"App",setup(){const n=w(null),e=(g,C="")=>{console.error(`[App Error] ${C}:`,g),n.value=`${C}: ${g.message||g}`,setTimeout(()=>{n.value=null},5e3)},s=()=>{n.value=null};Ae((g,C,V)=>(e(g,`Component error (${V})`),!1));let o,i,c;try{o=Ye(),i=je(),c=eo()}catch(g){e(g,"Composable initialization failed"),o={territories:w([]),nodes:w([]),edges:w([]),chatInput:w(""),swot:w({})},i={viewBox:w({x:0,y:0,w:1600,h:900}),isPanning:w(!1)},c={selectedNode:w(null),quickNodeLabel:w("")}}const{territories:t,nodes:y,edges:r,chatInput:d,swot:u,runAnalysis:m,generateMap:x,saveSnapshot:S,loadSnapshot:P}=o,{viewBox:h,isPanning:le,onPanStart:de,onPanMove:ce,onPanEnd:ue,onWheel:ge,svgToWorld:So,worldToScreen:Io,zoomToNode:ye}=i,{selectedNode:Q,quickNodeLabel:he,editingNode:we,dragging:ko,nodeById:me,selectNode:pe,deselectNode:fe,quickAddNode:xe,onNodeDragStart:ve,onNodeDragMove:be,onNodeDragEnd:Ne}=c,Se=Le(()=>(100*(1600/h.w)).toFixed(0)),Ie=()=>{try{S(`manual-${Date.now()}`),console.log("âœ“ State saved successfully")}catch(g){e(g,"Save failed")}},ke=()=>{try{P(0),console.log("âœ“ State loaded successfully")}catch(g){e(g,"Load failed")}},Ee=()=>{try{confirm("Reset all data? This cannot be undone.")&&(t.splice(0),y.splice(0),r.splice(0),d.value="",u.strengths="",u.weaknesses="",u.opportunities="",u.threats="",console.log("âœ“ Reset complete"))}catch(g){e(g,"Reset failed")}},Ce=()=>{console.log("Node updated:",Q.value)},Me=g=>{try{const C=h.x+h.w/2,V=h.y+h.h/2,_=h.w/g,$=h.h/g;h.x=C-_/2,h.y=V-$/2,h.w=_,h.h=$}catch(C){e(C,"Zoom failed")}},Pe=()=>{try{h.x=0,h.y=0,h.w=1600,h.h=900}catch(g){e(g,"Center view failed")}};return De(()=>{try{x&&typeof x=="function"&&(x(),console.log("âœ“ Initial map generated"))}catch(g){e(g,"Initial map generation failed")}}),{chatInput:d,swot:u,territories:t,nodes:y,edges:r,selectedNode:Q,quickNodeLabel:he,editingNode:we,viewBox:h,isPanning:le,zoomPercentage:Se,runAnalysis:m,generateMap:x,handleSave:Ie,handleLoad:ke,handleReset:Ee,handleNodeUpdate:Ce,onWheel:ge,onPanStart:de,onPanMove:ce,onPanEnd:ue,onNodeDragStart:ve,onNodeDragMove:be,onNodeDragEnd:Ne,nodeById:me,selectNode:pe,deselectNode:fe,quickAddNode:xe,zoomToNode:ye,zoomAtCenter:Me,centerView:Pe,error:n,clearError:s}}},no={class:"app"},so={class:"sidebar"},ro={class:"row"},ao={class:"row"},io={class:"main"},lo={class:"toolbar"},co={class:"badge"},uo={class:"canvas-wrap"},go=["viewBox"],yo=["x","y","width","height"],ho=["x","y"],wo=["x1","y1","x2","y2"],mo=["onMousedown","onDblclick"],po=["x","y"],fo=["x","y"],xo={key:0,class:"inspector"};function vo(n,e,s,o,i,c){return b(),v("div",no,[a("aside",so,[a("div",null,[e[29]||(e[29]=a("h2",null,"Character Chat â–¸ Needs",-1)),N(a("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.chatInput=t),placeholder:"e.g. I want to prepare for IELTS in 8 weeks; I struggle with timing and writing Task 1..."},null,512),[[I,o.chatInput]]),a("div",ro,[a("button",{class:"btn",onClick:e[1]||(e[1]=(...t)=>o.runAnalysis&&o.runAnalysis(...t))},"Analyze â–¸ SWOT"),a("button",{class:"btn",onClick:e[2]||(e[2]=(...t)=>o.generateMap&&o.generateMap(...t))},"Generate Map")])]),a("div",null,[e[30]||(e[30]=a("h2",null,"SWOT (editable)",-1)),e[31]||(e[31]=a("label",{class:"muted"},"Strengths",-1)),N(a("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.swot.strengths=t)},null,512),[[I,o.swot.strengths]]),e[32]||(e[32]=a("label",{class:"muted"},"Weaknesses",-1)),N(a("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.swot.weaknesses=t)},null,512),[[I,o.swot.weaknesses]]),e[33]||(e[33]=a("label",{class:"muted"},"Opportunities",-1)),N(a("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.swot.opportunities=t)},null,512),[[I,o.swot.opportunities]]),e[34]||(e[34]=a("label",{class:"muted"},"Threats",-1)),N(a("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.swot.threats=t)},null,512),[[I,o.swot.threats]]),a("div",ao,[a("button",{class:"btn",onClick:e[7]||(e[7]=(...t)=>o.handleSave&&o.handleSave(...t))},"Save"),a("button",{class:"btn",onClick:e[8]||(e[8]=(...t)=>o.handleLoad&&o.handleLoad(...t))},"Load"),a("button",{class:"btn",onClick:e[9]||(e[9]=(...t)=>o.handleReset&&o.handleReset(...t))},"Reset")])])]),a("main",io,[a("div",lo,[a("span",co,"Zoom: "+D(o.zoomPercentage)+"%",1),a("button",{class:"btn",onClick:e[10]||(e[10]=()=>o.zoomAtCenter(1.2))},"+"),a("button",{class:"btn",onClick:e[11]||(e[11]=()=>o.zoomAtCenter(1/1.2))},"âˆ’"),a("button",{class:"btn",onClick:e[12]||(e[12]=(...t)=>o.centerView&&o.centerView(...t))},"Center"),N(a("input",{type:"text",placeholder:"Quick add node (Label)","onUpdate:modelValue":e[13]||(e[13]=t=>o.quickNodeLabel=t),onKeydown:e[14]||(e[14]=Te((...t)=>o.quickAddNode&&o.quickAddNode(...t),["enter"]))},null,544),[[I,o.quickNodeLabel]]),a("button",{class:"btn",onClick:e[15]||(e[15]=(...t)=>o.quickAddNode&&o.quickAddNode(...t))},"Add Node"),e[35]||(e[35]=a("span",{class:"muted"},"Click+Drag to pan Â· Scroll to zoom Â· Drag nodes",-1))]),a("section",uo,[(b(),v("svg",{class:oe({dragging:o.isPanning}),viewBox:`${o.viewBox.x} ${o.viewBox.y} ${o.viewBox.w} ${o.viewBox.h}`,onMousedown:e[16]||(e[16]=(...t)=>o.onPanStart&&o.onPanStart(...t)),onMousemove:e[17]||(e[17]=(...t)=>o.onPanMove&&o.onPanMove(...t)),onMouseup:e[18]||(e[18]=(...t)=>o.onPanEnd&&o.onPanEnd(...t)),onMouseleave:e[19]||(e[19]=(...t)=>o.onPanEnd&&o.onPanEnd(...t)),onWheel:e[20]||(e[20]=q((...t)=>o.onWheel&&o.onWheel(...t),["prevent"]))},[e[36]||(e[36]=a("defs",null,[a("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse"},[a("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#b9bfd2"})])],-1)),(b(!0),v(Y,null,z(o.territories,t=>(b(),v("g",{key:t.id},[a("rect",{class:"territory",x:t.x,y:t.y,rx:12,ry:12,width:t.w,height:t.h},null,8,yo),a("text",{class:"territory-title",x:t.x+10,y:t.y+18},D(t.label),9,ho)]))),128)),a("g",null,[(b(!0),v(Y,null,z(o.edges,t=>{var y,r,d,u;return b(),v("line",{key:t.id,class:"edge",x1:((y=o.nodeById(t.source))==null?void 0:y.x)||0,y1:((r=o.nodeById(t.source))==null?void 0:r.y)||0,x2:((d=o.nodeById(t.target))==null?void 0:d.x)||0,y2:((u=o.nodeById(t.target))==null?void 0:u.y)||0},null,8,wo)}),128))]),(b(!0),v(Y,null,z(o.nodes,t=>(b(),v("g",{key:t.id,onMousedown:q(y=>o.onNodeDragStart(y,t),["stop"]),onDblclick:q(()=>o.selectNode(t),["stop"])},[a("rect",{class:oe(["node",o.selectedNode&&o.selectedNode.id===t.id?"selected":""]),x:t.x-60,y:t.y-22,rx:"10",ry:"10",width:"120",height:"44"},null,10,po),a("text",{class:"node-label",x:t.x,y:t.y+4,"text-anchor":"middle"},D(t.label),9,fo)],40,mo))),128))],42,go)),o.selectedNode?(b(),v("div",xo,[a("h3",null,D(o.selectedNode.label),1),N(a("input",{"onUpdate:modelValue":e[21]||(e[21]=t=>o.selectedNode.label=t),placeholder:"Node Label",onInput:e[22]||(e[22]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},null,544),[[I,o.selectedNode.label]]),N(a("textarea",{"onUpdate:modelValue":e[23]||(e[23]=t=>o.selectedNode.note=t),placeholder:"Notes...",onInput:e[24]||(e[24]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},null,544),[[I,o.selectedNode.note]]),N(a("select",{"onUpdate:modelValue":e[25]||(e[25]=t=>o.selectedNode.status=t),onChange:e[26]||(e[26]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},[...e[37]||(e[37]=[a("option",{value:"todo"},"To Do",-1),a("option",{value:"in-progress"},"In Progress",-1),a("option",{value:"done"},"Done",-1)])],544),[[Oe,o.selectedNode.status]]),a("button",{class:"btn",onClick:e[27]||(e[27]=(...t)=>o.deselectNode&&o.deselectNode(...t))},"Close")])):ee("",!0)])]),o.error?(b(),v("div",{key:0,class:"error-banner",onClick:e[28]||(e[28]=(...t)=>o.clearError&&o.clearError(...t))},D(o.error)+" (click to dismiss) ",1)):ee("",!0)])}const bo=oo(to,[["render",vo],["__scopeId","data-v-9b652b4d"]]),No=(n,e,s)=>{console.error("Global Error:",n),console.error("Component:",e),console.error("Error Info:",s)},Z=Re(bo);Z.config.errorHandler=No;Z.config.performance=!0;try{Z.mount("#app"),console.log("âœ“ Character Canvas initialized successfully")}catch(n){console.error("Failed to mount Vue app:",n),document.querySelector("#app").innerHTML=`
    <div style="padding: 20px; font-family: system-ui;">
      <h1 style="color: #c33;">Application Failed to Load</h1>
      <p>An error occurred while initializing the application.</p>
      <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto;">
${n.stack||n.message}
      </pre>
      <button onclick="location.reload()" style="padding: 10px 20px; border-radius: 6px; border: none; background: #111; color: #fff; cursor: pointer;">
        Reload Page
      </button>
    </div>
  `}
//# sourceMappingURL=index-CMhqwoZb.js.map
