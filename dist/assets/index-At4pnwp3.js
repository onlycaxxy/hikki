import{r as N,a as u,c as f,b as s,d as K,w as x,v as b,t as M,e as be,f as T,n as j,F as O,g as W,h as Ne,o as Se,i as ke,j as Ce,k as h,l as Ie}from"./vue-vendor-CDkDDy0R.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const d of a)if(d.type==="childList")for(const t of d.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&o(t)}).observe(document,{childList:!0,subtree:!0});function r(a){const d={};return a.integrity&&(d.integrity=a.integrity),a.referrerPolicy&&(d.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?d.credentials="include":a.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(a){if(a.ep)return;a.ep=!0;const d=r(a);fetch(a.href,d)}})();const D=N([]),v=N([]),L=N([]),Z=u(""),E=N({strengths:"",weaknesses:"",opportunities:"",threats:""});function Q(n){try{const e=localStorage.getItem("mvp-history"),r=e?JSON.parse(e):[],o={territories:JSON.parse(JSON.stringify(D)),nodes:JSON.parse(JSON.stringify(v)),edges:JSON.parse(JSON.stringify(L)),swot:{...E},ts:Date.now(),name:n};r.push({id:crypto.randomUUID(),ts:Date.now(),name:n||`snap-${r.length+1}`,data:o}),localStorage.setItem("mvp-history",JSON.stringify(r))}catch(e){throw console.error("Failed to save snapshot:",e),new Error(`Snapshot save failed: ${e.message}`)}}function Ue(n){try{const e=localStorage.getItem("mvp-history");if(!e)throw new Error("No saved history found");const o=JSON.parse(e)[n];if(!o||!o.data)throw new Error(`Invalid snapshot at index ${n}`);D.splice(0),v.splice(0),L.splice(0),(o.data.territories||[]).forEach(a=>D.push(a)),(o.data.nodes||[]).forEach(a=>v.push(a)),(o.data.edges||[]).forEach(a=>L.push(a)),o.data.swot&&Object.assign(E,o.data.swot)}catch(e){throw console.error("Failed to load snapshot:",e),new Error(`Snapshot load failed: ${e.message}`)}}function Ee(){Z.value.toLowerCase().includes("ielts")?(E.strengths="Good listening",E.weaknesses="Timing in writing"):E.strengths="Creative",alert("SWOT drafted (stub).")}function De(){D.splice(0),v.splice(0),L.splice(0);const n={id:crypto.randomUUID(),label:"Listening",x:40,y:40,w:360,h:300},e={id:crypto.randomUUID(),label:"Writing",x:440,y:40,w:360,h:300};D.push(n,e);const r={id:crypto.randomUUID(),label:"Baseline test",x:n.x+120,y:n.y+80,territoryId:n.id,note:"",status:"todo",timestamp:Date.now()},o={id:crypto.randomUUID(),label:"Targeted drills",x:n.x+220,y:n.y+160,territoryId:n.id,note:"",status:"todo",timestamp:Date.now()},a={id:crypto.randomUUID(),label:"Task 1 practice",x:e.x+120,y:e.y+80,territoryId:e.id,note:"",status:"todo",timestamp:Date.now()};v.push(r,o,a),L.push({id:crypto.randomUUID(),source:r.id,target:o.id}),Q("auto-generate")}function Le(){return{territories:D,nodes:v,edges:L,chatInput:Z,swot:E,saveSnapshot:Q,loadSnapshot:Ue,runAnalysis:Ee,generateMap:De}}const I=N({x:0,y:0,w:1600,h:900}),l=N({x:I.x,y:I.y,w:I.w,h:I.h}),P=u(!1),U=N({x:0,y:0});function q(n){const e=document.querySelector("svg");if(!e)return console.warn("SVG element not found"),{x:0,y:0};const r=e.getBoundingClientRect(),o=(n.clientX-r.left)/r.width,a=(n.clientY-r.top)/r.height;return{x:l.x+o*l.w,y:l.y+a*l.h}}function Me(n){const e=document.querySelector("svg");if(!e)return console.warn("SVG element not found"),{x:0,y:0,rect:null};const r=e.getBoundingClientRect(),o=(n.x-l.x)/l.w*r.width+r.left,a=(n.y-l.y)/l.h*r.height+r.top;return{x:o,y:a,rect:r}}function Pe(n){P.value=!0,U.x=n.clientX,U.y=n.clientY}function Ae(n){if(!P.value)return;const e=n.currentTarget,r=(n.clientX-U.x)*(l.w/e.clientWidth),o=(n.clientY-U.y)*(l.h/e.clientHeight);l.x-=r,l.y-=o,U.x=n.clientX,U.y=n.clientY}function Be(){P.value=!1}const Te=n=>{const r=n.currentTarget.getBoundingClientRect(),o=n.clientX-r.left,a=n.clientY-r.top,d=n.deltaY<0?.9:1.1,t=l.x+o/r.width*l.w,g=l.y+a/r.height*l.h,y=l.w*d,m=l.h*d;l.x=t-o/r.width*y,l.y=g-a/r.height*m,l.w=y,l.h=m};function Oe(n,e=2,r=300){const o={x:l.x,y:l.y,w:l.w,h:l.h},a=n.x,d=n.y,t=I.w/e,g=I.h/e,y={x:a-t/2,y:d-g/2,w:t,h:g},m=performance.now();function p(A){const S=Math.min(1,(A-m)/r),C=1-Math.pow(1-S,2);l.x=o.x+(y.x-o.x)*C,l.y=o.y+(y.y-o.y)*C,l.w=o.w+(y.w-o.w)*C,l.h=o.h+(y.h-o.h)*C,S<1&&requestAnimationFrame(p)}requestAnimationFrame(p)}function We(){return{viewBox:l,isPanning:P,onPanStart:Pe,onPanMove:Ae,onPanEnd:Be,onWheel:Te,svgToWorld:q,worldToScreen:Me,zoomToNode:Oe}}const z=u(null),V=u(""),F=u(null),w=N({active:!1,id:null,ox:0,oy:0});function Ve(n){return v.find(e=>e.id===n)}function qe(n){z.value=n,F.value=n}function ze(){z.value=null,F.value=null}function Fe(){const n=V.value.trim();if(!n){console.warn("Cannot add node with empty label");return}const r={id:crypto.randomUUID(),label:n,x:l.x+l.w/2,y:l.y+l.h/2,territoryId:null,note:"",status:"todo",timestamp:Date.now()};v.push(r),V.value=""}const Re=(n,e)=>{n.stopPropagation();const r=q(n);w.active=!0,w.id=e.id,w.ox=r.x-e.x,w.oy=r.y-e.y,window.addEventListener("mousemove",R),window.addEventListener("mouseup",J)},R=n=>{if(!w.active||!w.id)return;const e=q(n),r=v.find(o=>o.id===w.id);r&&(r.x=e.x-w.ox,r.y=e.y-w.oy)},J=n=>{w.active=!1,w.id=null,window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",J)};function Je(){return{selectedNode:z,quickNodeLabel:V,editingNode:F,dragging:w,nodeById:Ve,selectNode:qe,deselectNode:ze,quickAddNode:Fe,onNodeDragStart:Re,onNodeDragMove:R,onNodeDragEnd:J}}const Ye=(n,e)=>{const r=n.__vccOpts||n;for(const[o,a]of e)r[o]=a;return r},He={name:"App",setup(){const n=u(null),e=(i,k="")=>{console.error(`[App Error] ${k}:`,i),n.value=`${k}: ${i.message||i}`,setTimeout(()=>{n.value=null},5e3)},r=()=>{n.value=null};Se((i,k,B)=>(e(i,`Component error (${B})`),!1));let o,a,d;try{o=Le(),a=We(),d=Je()}catch(i){e(i,"Composable initialization failed"),o={territories:u([]),nodes:u([]),edges:u([]),chatInput:u(""),swot:u({})},a={viewBox:u({x:0,y:0,w:1600,h:900}),isPanning:u(!1)},d={selectedNode:u(null),quickNodeLabel:u("")}}const{territories:t,nodes:g,edges:y,chatInput:m,swot:p,runAnalysis:A,generateMap:S,saveSnapshot:C,loadSnapshot:_}=o,{viewBox:c,isPanning:$,onPanStart:ee,onPanMove:oe,onPanEnd:te,onWheel:ne,svgToWorld:yo,worldToScreen:go,zoomToNode:re}=a,{selectedNode:H,quickNodeLabel:se,editingNode:ae,dragging:wo,nodeById:le,selectNode:ie,deselectNode:de,quickAddNode:ce,onNodeDragStart:ue,onNodeDragMove:ye,onNodeDragEnd:ge}=d,we=ke(()=>(100*(1600/c.w)).toFixed(0)),pe=()=>{try{C(`manual-${Date.now()}`),console.log("✓ State saved successfully")}catch(i){e(i,"Save failed")}},me=()=>{try{_(0),console.log("✓ State loaded successfully")}catch(i){e(i,"Load failed")}},fe=()=>{try{confirm("Reset all data? This cannot be undone.")&&(t.splice(0),g.splice(0),y.splice(0),m.value="",p.strengths="",p.weaknesses="",p.opportunities="",p.threats="",console.log("✓ Reset complete"))}catch(i){e(i,"Reset failed")}},he=()=>{console.log("Node updated:",H.value)},xe=i=>{try{const k=c.x+c.w/2,B=c.y+c.h/2,X=c.w/i,G=c.h/i;c.x=k-X/2,c.y=B-G/2,c.w=X,c.h=G}catch(k){e(k,"Zoom failed")}},ve=()=>{try{c.x=0,c.y=0,c.w=1600,c.h=900}catch(i){e(i,"Center view failed")}};return Ce(()=>{try{S&&typeof S=="function"&&(S(),console.log("✓ Initial map generated"))}catch(i){e(i,"Initial map generation failed")}}),{chatInput:m,swot:p,territories:t,nodes:g,edges:y,selectedNode:H,quickNodeLabel:se,editingNode:ae,viewBox:c,isPanning:$,zoomPercentage:we,runAnalysis:A,generateMap:S,handleSave:pe,handleLoad:me,handleReset:fe,handleNodeUpdate:he,onWheel:ne,onPanStart:ee,onPanMove:oe,onPanEnd:te,onNodeDragStart:ue,onNodeDragMove:ye,onNodeDragEnd:ge,nodeById:le,selectNode:ie,deselectNode:de,quickAddNode:ce,zoomToNode:re,zoomAtCenter:xe,centerView:ve,error:n,clearError:r}}},Xe={class:"app"},Ge={class:"sidebar"},Ke={class:"row"},je={class:"row"},Ze={class:"main"},Qe={class:"toolbar"},_e={class:"badge"},$e={class:"canvas-wrap"},eo=["viewBox"],oo=["x","y","width","height"],to=["x","y"],no=["x1","y1","x2","y2"],ro=["onMousedown","onDblclick"],so=["x","y"],ao=["x","y"],lo={key:0,class:"inspector"};function io(n,e,r,o,a,d){return h(),f("div",Xe,[s("aside",Ge,[s("div",null,[e[29]||(e[29]=s("h2",null,"Character Chat ▸ Needs",-1)),x(s("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.chatInput=t),placeholder:"e.g. I want to prepare for IELTS in 8 weeks; I struggle with timing and writing Task 1..."},null,512),[[b,o.chatInput]]),s("div",Ke,[s("button",{class:"btn",onClick:e[1]||(e[1]=(...t)=>o.runAnalysis&&o.runAnalysis(...t))},"Analyze ▸ SWOT"),s("button",{class:"btn",onClick:e[2]||(e[2]=(...t)=>o.generateMap&&o.generateMap(...t))},"Generate Map")])]),s("div",null,[e[30]||(e[30]=s("h2",null,"SWOT (editable)",-1)),e[31]||(e[31]=s("label",{class:"muted"},"Strengths",-1)),x(s("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.swot.strengths=t)},null,512),[[b,o.swot.strengths]]),e[32]||(e[32]=s("label",{class:"muted"},"Weaknesses",-1)),x(s("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.swot.weaknesses=t)},null,512),[[b,o.swot.weaknesses]]),e[33]||(e[33]=s("label",{class:"muted"},"Opportunities",-1)),x(s("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.swot.opportunities=t)},null,512),[[b,o.swot.opportunities]]),e[34]||(e[34]=s("label",{class:"muted"},"Threats",-1)),x(s("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.swot.threats=t)},null,512),[[b,o.swot.threats]]),s("div",je,[s("button",{class:"btn",onClick:e[7]||(e[7]=(...t)=>o.handleSave&&o.handleSave(...t))},"Save"),s("button",{class:"btn",onClick:e[8]||(e[8]=(...t)=>o.handleLoad&&o.handleLoad(...t))},"Load"),s("button",{class:"btn",onClick:e[9]||(e[9]=(...t)=>o.handleReset&&o.handleReset(...t))},"Reset")])])]),s("main",Ze,[s("div",Qe,[s("span",_e,"Zoom: "+M(o.zoomPercentage)+"%",1),s("button",{class:"btn",onClick:e[10]||(e[10]=()=>o.zoomAtCenter(1.2))},"+"),s("button",{class:"btn",onClick:e[11]||(e[11]=()=>o.zoomAtCenter(1/1.2))},"−"),s("button",{class:"btn",onClick:e[12]||(e[12]=(...t)=>o.centerView&&o.centerView(...t))},"Center"),x(s("input",{type:"text",placeholder:"Quick add node (Label)","onUpdate:modelValue":e[13]||(e[13]=t=>o.quickNodeLabel=t),onKeydown:e[14]||(e[14]=be((...t)=>o.quickAddNode&&o.quickAddNode(...t),["enter"]))},null,544),[[b,o.quickNodeLabel]]),s("button",{class:"btn",onClick:e[15]||(e[15]=(...t)=>o.quickAddNode&&o.quickAddNode(...t))},"Add Node"),e[35]||(e[35]=s("span",{class:"muted"},"Click+Drag to pan · Scroll to zoom · Drag nodes",-1))]),s("section",$e,[(h(),f("svg",{class:j({dragging:o.isPanning}),viewBox:`${o.viewBox.x} ${o.viewBox.y} ${o.viewBox.w} ${o.viewBox.h}`,onMousedown:e[16]||(e[16]=(...t)=>o.onPanStart&&o.onPanStart(...t)),onMousemove:e[17]||(e[17]=(...t)=>o.onPanMove&&o.onPanMove(...t)),onMouseup:e[18]||(e[18]=(...t)=>o.onPanEnd&&o.onPanEnd(...t)),onMouseleave:e[19]||(e[19]=(...t)=>o.onPanEnd&&o.onPanEnd(...t)),onWheel:e[20]||(e[20]=T((...t)=>o.onWheel&&o.onWheel(...t),["prevent"]))},[e[36]||(e[36]=s("defs",null,[s("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse"},[s("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#b9bfd2"})])],-1)),(h(!0),f(O,null,W(o.territories,t=>(h(),f("g",{key:t.id},[s("rect",{class:"territory",x:t.x,y:t.y,rx:12,ry:12,width:t.w,height:t.h},null,8,oo),s("text",{class:"territory-title",x:t.x+10,y:t.y+18},M(t.label),9,to)]))),128)),s("g",null,[(h(!0),f(O,null,W(o.edges,t=>{var g,y,m,p;return h(),f("line",{key:t.id,class:"edge",x1:((g=o.nodeById(t.source))==null?void 0:g.x)||0,y1:((y=o.nodeById(t.source))==null?void 0:y.y)||0,x2:((m=o.nodeById(t.target))==null?void 0:m.x)||0,y2:((p=o.nodeById(t.target))==null?void 0:p.y)||0},null,8,no)}),128))]),(h(!0),f(O,null,W(o.nodes,t=>(h(),f("g",{key:t.id,onMousedown:T(g=>o.onNodeDragStart(g,t),["stop"]),onDblclick:T(()=>o.selectNode(t),["stop"])},[s("rect",{class:j(["node",o.selectedNode&&o.selectedNode.id===t.id?"selected":""]),x:t.x-60,y:t.y-22,rx:"10",ry:"10",width:"120",height:"44"},null,10,so),s("text",{class:"node-label",x:t.x,y:t.y+4,"text-anchor":"middle"},M(t.label),9,ao)],40,ro))),128))],42,eo)),o.selectedNode?(h(),f("div",lo,[s("h3",null,M(o.selectedNode.label),1),x(s("input",{"onUpdate:modelValue":e[21]||(e[21]=t=>o.selectedNode.label=t),placeholder:"Node Label",onInput:e[22]||(e[22]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},null,544),[[b,o.selectedNode.label]]),x(s("textarea",{"onUpdate:modelValue":e[23]||(e[23]=t=>o.selectedNode.note=t),placeholder:"Notes...",onInput:e[24]||(e[24]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},null,544),[[b,o.selectedNode.note]]),x(s("select",{"onUpdate:modelValue":e[25]||(e[25]=t=>o.selectedNode.status=t),onChange:e[26]||(e[26]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},[...e[37]||(e[37]=[s("option",{value:"todo"},"To Do",-1),s("option",{value:"in-progress"},"In Progress",-1),s("option",{value:"done"},"Done",-1)])],544),[[Ne,o.selectedNode.status]]),s("button",{class:"btn",onClick:e[27]||(e[27]=(...t)=>o.deselectNode&&o.deselectNode(...t))},"Close")])):K("",!0)])]),o.error?(h(),f("div",{key:0,class:"error-banner",onClick:e[28]||(e[28]=(...t)=>o.clearError&&o.clearError(...t))},M(o.error)+" (click to dismiss) ",1)):K("",!0)])}const co=Ye(He,[["render",io],["__scopeId","data-v-9b652b4d"]]),uo=(n,e,r)=>{console.error("Global Error:",n),console.error("Component:",e),console.error("Error Info:",r)},Y=Ie(co);Y.config.errorHandler=uo;Y.config.performance=!0;try{Y.mount("#app"),console.log("✓ Character Canvas initialized successfully")}catch(n){console.error("Failed to mount Vue app:",n),document.querySelector("#app").innerHTML=`
    <div style="padding: 20px; font-family: system-ui;">
      <h1 style="color: #c33;">Application Failed to Load</h1>
      <p>An error occurred while initializing the application.</p>
      <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto;">
${n.stack||n.message}
      </pre>
      <button onclick="location.reload()" style="padding: 10px 20px; border-radius: 6px; border: none; background: #111; color: #fff; cursor: pointer;">
        Reload Page
      </button>
    </div>
  `}
//# sourceMappingURL=index-At4pnwp3.js.map
