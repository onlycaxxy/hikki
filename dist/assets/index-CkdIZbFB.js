import{r as I,a as w,c as m,b as a,d as $,w as b,v as S,t as L,e as Pe,f as V,n as ee,F as q,g as Y,h as Oe,o as De,i as Le,j as Ae,k as x,l as Re}from"./vue-vendor-CDkDDy0R.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const t of c.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&o(t)}).observe(document,{childList:!0,subtree:!0});function s(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(i){if(i.ep)return;i.ep=!0;const c=s(i);fetch(i.href,c)}})();const k=I([]),v=I([]),D=I([]),F=w(""),O=I({strengths:"",weaknesses:"",opportunities:"",threats:""});function ne(n){try{const e=localStorage.getItem("mvp-history"),s=e?JSON.parse(e):[],o={territories:JSON.parse(JSON.stringify(k)),nodes:JSON.parse(JSON.stringify(v)),edges:JSON.parse(JSON.stringify(D)),swot:{...O},ts:Date.now(),name:n};s.push({id:crypto.randomUUID(),ts:Date.now(),name:n||`snap-${s.length+1}`,data:o}),localStorage.setItem("mvp-history",JSON.stringify(s))}catch(e){throw console.error("Failed to save snapshot:",e),new Error(`Snapshot save failed: ${e.message}`)}}function Ue(n){try{const e=localStorage.getItem("mvp-history");if(!e)throw new Error("No saved history found");const o=JSON.parse(e)[n];if(!o||!o.data)throw new Error(`Invalid snapshot at index ${n}`);k.splice(0),v.splice(0),D.splice(0),(o.data.territories||[]).forEach(i=>k.push(i)),(o.data.nodes||[]).forEach(i=>v.push(i)),(o.data.edges||[]).forEach(i=>D.push(i)),o.data.swot&&Object.assign(O,o.data.swot)}catch(e){throw console.error("Failed to load snapshot:",e),new Error(`Snapshot load failed: ${e.message}`)}}const M=20,se=60,R=180,U=80,re=20,ae=20,A=2,oe=50,te=3;function Be(n){const e=Math.ceil(n/A),s=M*2+A*R+(A-1)*re,o=se+M*2+e*U+(e-1)*ae;return{width:Math.max(s,400),height:Math.max(o,350)}}function We(n,e,s){const o=s%A,i=Math.floor(s/A),c=e.x+M+o*(R+re),t=e.y+se+M+i*(U+ae),r=e.x+e.w-R-M,d=e.y+e.h-U-M,g=Math.min(c,r),u=Math.min(t,d);return(c!==g||t!==u)&&console.warn(`⚠️ Node "${n.label}" clamped in territory "${e.label}":`,{original:{x:c,y:t},clamped:{x:g,y:u},territory:{bounds:{x:e.x,y:e.y,w:e.w,h:e.h},maxAllowed:{x:r,y:d}}}),{x:g,y:u}}function Ve(){F.value.toLowerCase().includes("ielts")?(O.strengths="Good listening",O.weaknesses="Timing in writing"):O.strengths="Creative",alert("SWOT drafted (stub).")}async function qe(){try{k.splice(0),v.splice(0),D.splice(0);const n=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:F.value||"Create a learning plan for IELTS preparation with listening, reading, writing, and speaking skills"})});if(!n.ok)throw new Error(`API error: ${n.status}`);const s=(await n.json()).data,o=s.nodes.map(r=>({id:r.id||crypto.randomUUID(),label:r.label,type:r.type||"concept",note:"",status:"todo",timestamp:Date.now()})),i=s.edges.map(r=>({id:r.id||crypto.randomUUID(),source:r.source,target:r.target,type:r.type||"relationship"}));o.forEach(r=>v.push(r)),i.forEach(r=>D.push(r)),s.territories&&s.territories.length>0&&(console.log("🗺️ Creating territories with dynamic sizing..."),s.territories.forEach((r,d)=>{const g=(r.nodeIds||[]).length,u=Be(g),C=d%te,N=Math.floor(d/te),f={id:r.id||crypto.randomUUID(),label:r.name,x:100+C*(u.width+oe),y:100+N*(u.height+oe),w:u.width,h:u.height,nodeIds:r.nodeIds||[]};k.push(f),console.log(`  📦 Territory "${f.label}":`,{nodes:g,dimensions:{w:u.width,h:u.height},position:{x:f.x,y:f.y}})})),console.log(`
📍 Positioning nodes within territories...`);let c=0,t=0;v.forEach(r=>{const d=k.find(g=>g.nodeIds&&g.nodeIds.includes(r.id));if(d){const g=d.nodeIds.indexOf(r.id),u=We(r,d,g);r.x=u.x,r.y=u.y,c++,r.x>=d.x&&r.x+R<=d.x+d.w&&r.y>=d.y&&r.y+U<=d.y+d.h||console.error(`❌ Node "${r.label}" STILL outside territory "${d.label}"!`,{node:{x:r.x,y:r.y},territory:{x:d.x,y:d.y,w:d.w,h:d.h}})}else r.x=Math.random()*800+100,r.y=Math.random()*600+100,t++,console.warn(`⚠️ Node "${r.label}" has no territory assignment`)}),console.log(`✓ Positioned ${c} nodes, ${t} outside territories`),ne("auto-generate"),console.log("✓ Map generated from LLM with algorithmic positioning")}catch(n){console.error("Map generation failed:",n),alert(`Failed to generate map: ${n.message}`)}}function Ye(){return{territories:k,nodes:v,edges:D,chatInput:F,swot:O,saveSnapshot:ne,loadSnapshot:Ue,runAnalysis:Ve,generateMap:qe}}const T=I({x:0,y:0,w:1600,h:900}),l=I({x:T.x,y:T.y,w:T.w,h:T.h}),B=w(!1),P=I({x:0,y:0});function G(n){const e=document.querySelector("svg");if(!e)return console.warn("SVG element not found"),{x:0,y:0};const s=e.getBoundingClientRect(),o=(n.clientX-s.left)/s.width,i=(n.clientY-s.top)/s.height;return{x:l.x+o*l.w,y:l.y+i*l.h}}function ze(n){const e=document.querySelector("svg");if(!e)return console.warn("SVG element not found"),{x:0,y:0,rect:null};const s=e.getBoundingClientRect(),o=(n.x-l.x)/l.w*s.width+s.left,i=(n.y-l.y)/l.h*s.height+s.top;return{x:o,y:i,rect:s}}function Fe(n){B.value=!0,P.x=n.clientX,P.y=n.clientY}function Ge(n){if(!B.value)return;const e=n.currentTarget,s=(n.clientX-P.x)*(l.w/e.clientWidth),o=(n.clientY-P.y)*(l.h/e.clientHeight);l.x-=s,l.y-=o,P.x=n.clientX,P.y=n.clientY}function He(){B.value=!1}const Je=n=>{const s=n.currentTarget.getBoundingClientRect(),o=n.clientX-s.left,i=n.clientY-s.top,c=n.deltaY<0?.9:1.1,t=l.x+o/s.width*l.w,r=l.y+i/s.height*l.h,d=l.w*c,g=l.h*c;l.x=t-o/s.width*d,l.y=r-i/s.height*g,l.w=d,l.h=g};function Xe(n,e=2,s=300){const o={x:l.x,y:l.y,w:l.w,h:l.h},i=n.x,c=n.y,t=T.w/e,r=T.h/e,d={x:i-t/2,y:c-r/2,w:t,h:r},g=performance.now();function u(C){const N=Math.min(1,(C-g)/s),f=1-Math.pow(1-N,2);l.x=o.x+(d.x-o.x)*f,l.y=o.y+(d.y-o.y)*f,l.w=o.w+(d.w-o.w)*f,l.h=o.h+(d.h-o.h)*f,N<1&&requestAnimationFrame(u)}requestAnimationFrame(u)}function je(){return{viewBox:l,isPanning:B,onPanStart:Fe,onPanMove:Ge,onPanEnd:He,onWheel:Je,svgToWorld:G,worldToScreen:ze,zoomToNode:Xe}}const H=w(null),z=w(""),J=w(null),p=I({active:!1,id:null,ox:0,oy:0});function Ke(n){return v.find(e=>e.id===n)}function Ze(n){H.value=n,J.value=n}function Qe(){H.value=null,J.value=null}function _e(){const n=z.value.trim();if(!n){console.warn("Cannot add node with empty label");return}const s={id:crypto.randomUUID(),label:n,x:l.x+l.w/2,y:l.y+l.h/2,territoryId:null,note:"",status:"todo",timestamp:Date.now()};v.push(s),z.value=""}const $e=(n,e)=>{n.stopPropagation();const s=G(n);p.active=!0,p.id=e.id,p.ox=s.x-e.x,p.oy=s.y-e.y,window.addEventListener("mousemove",X),window.addEventListener("mouseup",j)},X=n=>{if(!p.active||!p.id)return;const e=G(n),s=v.find(o=>o.id===p.id);s&&(s.x=e.x-p.ox,s.y=e.y-p.oy)},j=n=>{p.active=!1,p.id=null,window.removeEventListener("mousemove",X),window.removeEventListener("mouseup",j)};function eo(){return{selectedNode:H,quickNodeLabel:z,editingNode:J,dragging:p,nodeById:Ke,selectNode:Ze,deselectNode:Qe,quickAddNode:_e,onNodeDragStart:$e,onNodeDragMove:X,onNodeDragEnd:j}}const oo=(n,e)=>{const s=n.__vccOpts||n;for(const[o,i]of e)s[o]=i;return s},to={name:"App",setup(){const n=w(null),e=(y,E="")=>{console.error(`[App Error] ${E}:`,y),n.value=`${E}: ${y.message||y}`,setTimeout(()=>{n.value=null},5e3)},s=()=>{n.value=null};De((y,E,W)=>(e(y,`Component error (${W})`),!1));let o,i,c;try{o=Ye(),i=je(),c=eo()}catch(y){e(y,"Composable initialization failed"),o={territories:w([]),nodes:w([]),edges:w([]),chatInput:w(""),swot:w({})},i={viewBox:w({x:0,y:0,w:1600,h:900}),isPanning:w(!1)},c={selectedNode:w(null),quickNodeLabel:w("")}}const{territories:t,nodes:r,edges:d,chatInput:g,swot:u,runAnalysis:C,generateMap:N,saveSnapshot:f,loadSnapshot:ie}=o,{viewBox:h,isPanning:le,onPanStart:de,onPanMove:ce,onPanEnd:ue,onWheel:ge,svgToWorld:So,worldToScreen:Io,zoomToNode:ye}=i,{selectedNode:Z,quickNodeLabel:he,editingNode:we,dragging:Eo,nodeById:pe,selectNode:fe,deselectNode:me,quickAddNode:xe,onNodeDragStart:ve,onNodeDragMove:Ne,onNodeDragEnd:be}=c,Se=Le(()=>(100*(1600/h.w)).toFixed(0)),Ie=()=>{try{f(`manual-${Date.now()}`),console.log("✓ State saved successfully")}catch(y){e(y,"Save failed")}},Ee=()=>{try{ie(0),console.log("✓ State loaded successfully")}catch(y){e(y,"Load failed")}},ke=()=>{try{confirm("Reset all data? This cannot be undone.")&&(t.splice(0),r.splice(0),d.splice(0),g.value="",u.strengths="",u.weaknesses="",u.opportunities="",u.threats="",console.log("✓ Reset complete"))}catch(y){e(y,"Reset failed")}},Ce=()=>{console.log("Node updated:",Z.value)},Me=y=>{try{const E=h.x+h.w/2,W=h.y+h.h/2,Q=h.w/y,_=h.h/y;h.x=E-Q/2,h.y=W-_/2,h.w=Q,h.h=_}catch(E){e(E,"Zoom failed")}},Te=()=>{try{h.x=0,h.y=0,h.w=1600,h.h=900}catch(y){e(y,"Center view failed")}};return Ae(()=>{try{N&&typeof N=="function"&&(N(),console.log("✓ Initial map generated"))}catch(y){e(y,"Initial map generation failed")}}),{chatInput:g,swot:u,territories:t,nodes:r,edges:d,selectedNode:Z,quickNodeLabel:he,editingNode:we,viewBox:h,isPanning:le,zoomPercentage:Se,runAnalysis:C,generateMap:N,handleSave:Ie,handleLoad:Ee,handleReset:ke,handleNodeUpdate:Ce,onWheel:ge,onPanStart:de,onPanMove:ce,onPanEnd:ue,onNodeDragStart:ve,onNodeDragMove:Ne,onNodeDragEnd:be,nodeById:pe,selectNode:fe,deselectNode:me,quickAddNode:xe,zoomToNode:ye,zoomAtCenter:Me,centerView:Te,error:n,clearError:s}}},no={class:"app"},so={class:"sidebar"},ro={class:"row"},ao={class:"row"},io={class:"main"},lo={class:"toolbar"},co={class:"badge"},uo={class:"canvas-wrap"},go=["viewBox"],yo=["x","y","width","height"],ho=["x","y"],wo=["x1","y1","x2","y2"],po=["onMousedown","onDblclick"],fo=["x","y"],mo=["x","y"],xo={key:0,class:"inspector"};function vo(n,e,s,o,i,c){return x(),m("div",no,[a("aside",so,[a("div",null,[e[29]||(e[29]=a("h2",null,"Character Chat ▸ Needs",-1)),b(a("textarea",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.chatInput=t),placeholder:"e.g. I want to prepare for IELTS in 8 weeks; I struggle with timing and writing Task 1..."},null,512),[[S,o.chatInput]]),a("div",ro,[a("button",{class:"btn",onClick:e[1]||(e[1]=(...t)=>o.runAnalysis&&o.runAnalysis(...t))},"Analyze ▸ SWOT"),a("button",{class:"btn",onClick:e[2]||(e[2]=(...t)=>o.generateMap&&o.generateMap(...t))},"Generate Map")])]),a("div",null,[e[30]||(e[30]=a("h2",null,"SWOT (editable)",-1)),e[31]||(e[31]=a("label",{class:"muted"},"Strengths",-1)),b(a("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.swot.strengths=t)},null,512),[[S,o.swot.strengths]]),e[32]||(e[32]=a("label",{class:"muted"},"Weaknesses",-1)),b(a("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.swot.weaknesses=t)},null,512),[[S,o.swot.weaknesses]]),e[33]||(e[33]=a("label",{class:"muted"},"Opportunities",-1)),b(a("textarea",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.swot.opportunities=t)},null,512),[[S,o.swot.opportunities]]),e[34]||(e[34]=a("label",{class:"muted"},"Threats",-1)),b(a("textarea",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.swot.threats=t)},null,512),[[S,o.swot.threats]]),a("div",ao,[a("button",{class:"btn",onClick:e[7]||(e[7]=(...t)=>o.handleSave&&o.handleSave(...t))},"Save"),a("button",{class:"btn",onClick:e[8]||(e[8]=(...t)=>o.handleLoad&&o.handleLoad(...t))},"Load"),a("button",{class:"btn",onClick:e[9]||(e[9]=(...t)=>o.handleReset&&o.handleReset(...t))},"Reset")])])]),a("main",io,[a("div",lo,[a("span",co,"Zoom: "+L(o.zoomPercentage)+"%",1),a("button",{class:"btn",onClick:e[10]||(e[10]=()=>o.zoomAtCenter(1.2))},"+"),a("button",{class:"btn",onClick:e[11]||(e[11]=()=>o.zoomAtCenter(1/1.2))},"−"),a("button",{class:"btn",onClick:e[12]||(e[12]=(...t)=>o.centerView&&o.centerView(...t))},"Center"),b(a("input",{type:"text",placeholder:"Quick add node (Label)","onUpdate:modelValue":e[13]||(e[13]=t=>o.quickNodeLabel=t),onKeydown:e[14]||(e[14]=Pe((...t)=>o.quickAddNode&&o.quickAddNode(...t),["enter"]))},null,544),[[S,o.quickNodeLabel]]),a("button",{class:"btn",onClick:e[15]||(e[15]=(...t)=>o.quickAddNode&&o.quickAddNode(...t))},"Add Node"),e[35]||(e[35]=a("span",{class:"muted"},"Click+Drag to pan · Scroll to zoom · Drag nodes",-1))]),a("section",uo,[(x(),m("svg",{class:ee({dragging:o.isPanning}),viewBox:`${o.viewBox.x} ${o.viewBox.y} ${o.viewBox.w} ${o.viewBox.h}`,onMousedown:e[16]||(e[16]=(...t)=>o.onPanStart&&o.onPanStart(...t)),onMousemove:e[17]||(e[17]=(...t)=>o.onPanMove&&o.onPanMove(...t)),onMouseup:e[18]||(e[18]=(...t)=>o.onPanEnd&&o.onPanEnd(...t)),onMouseleave:e[19]||(e[19]=(...t)=>o.onPanEnd&&o.onPanEnd(...t)),onWheel:e[20]||(e[20]=V((...t)=>o.onWheel&&o.onWheel(...t),["prevent"]))},[e[36]||(e[36]=a("defs",null,[a("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse"},[a("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#b9bfd2"})])],-1)),(x(!0),m(q,null,Y(o.territories,t=>(x(),m("g",{key:t.id},[a("rect",{class:"territory",x:t.x,y:t.y,rx:12,ry:12,width:t.w,height:t.h},null,8,yo),a("text",{class:"territory-title",x:t.x+10,y:t.y+18},L(t.label),9,ho)]))),128)),a("g",null,[(x(!0),m(q,null,Y(o.edges,t=>{var r,d,g,u;return x(),m("line",{key:t.id,class:"edge",x1:((r=o.nodeById(t.source))==null?void 0:r.x)||0,y1:((d=o.nodeById(t.source))==null?void 0:d.y)||0,x2:((g=o.nodeById(t.target))==null?void 0:g.x)||0,y2:((u=o.nodeById(t.target))==null?void 0:u.y)||0},null,8,wo)}),128))]),(x(!0),m(q,null,Y(o.nodes,t=>(x(),m("g",{key:t.id,onMousedown:V(r=>o.onNodeDragStart(r,t),["stop"]),onDblclick:V(()=>o.selectNode(t),["stop"])},[a("rect",{class:ee(["node",o.selectedNode&&o.selectedNode.id===t.id?"selected":""]),x:t.x-60,y:t.y-22,rx:"10",ry:"10",width:"120",height:"44"},null,10,fo),a("text",{class:"node-label",x:t.x,y:t.y+4,"text-anchor":"middle"},L(t.label),9,mo)],40,po))),128))],42,go)),o.selectedNode?(x(),m("div",xo,[a("h3",null,L(o.selectedNode.label),1),b(a("input",{"onUpdate:modelValue":e[21]||(e[21]=t=>o.selectedNode.label=t),placeholder:"Node Label",onInput:e[22]||(e[22]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},null,544),[[S,o.selectedNode.label]]),b(a("textarea",{"onUpdate:modelValue":e[23]||(e[23]=t=>o.selectedNode.note=t),placeholder:"Notes...",onInput:e[24]||(e[24]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},null,544),[[S,o.selectedNode.note]]),b(a("select",{"onUpdate:modelValue":e[25]||(e[25]=t=>o.selectedNode.status=t),onChange:e[26]||(e[26]=(...t)=>o.handleNodeUpdate&&o.handleNodeUpdate(...t))},[...e[37]||(e[37]=[a("option",{value:"todo"},"To Do",-1),a("option",{value:"in-progress"},"In Progress",-1),a("option",{value:"done"},"Done",-1)])],544),[[Oe,o.selectedNode.status]]),a("button",{class:"btn",onClick:e[27]||(e[27]=(...t)=>o.deselectNode&&o.deselectNode(...t))},"Close")])):$("",!0)])]),o.error?(x(),m("div",{key:0,class:"error-banner",onClick:e[28]||(e[28]=(...t)=>o.clearError&&o.clearError(...t))},L(o.error)+" (click to dismiss) ",1)):$("",!0)])}const No=oo(to,[["render",vo],["__scopeId","data-v-9b652b4d"]]),bo=(n,e,s)=>{console.error("Global Error:",n),console.error("Component:",e),console.error("Error Info:",s)},K=Re(No);K.config.errorHandler=bo;K.config.performance=!0;try{K.mount("#app"),console.log("✓ Character Canvas initialized successfully")}catch(n){console.error("Failed to mount Vue app:",n),document.querySelector("#app").innerHTML=`
    <div style="padding: 20px; font-family: system-ui;">
      <h1 style="color: #c33;">Application Failed to Load</h1>
      <p>An error occurred while initializing the application.</p>
      <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow: auto;">
${n.stack||n.message}
      </pre>
      <button onclick="location.reload()" style="padding: 10px 20px; border-radius: 6px; border: none; background: #111; color: #fff; cursor: pointer;">
        Reload Page
      </button>
    </div>
  `}
//# sourceMappingURL=index-CkdIZbFB.js.map
